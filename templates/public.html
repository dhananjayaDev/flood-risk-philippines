{% extends "base.html" %}

{% block head %}
<!-- Component CSS Files -->
<link href="{{ url_for('static', filename='css/weather-background.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/navbar.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/weather-info.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/weather-panels.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/weather-forecast.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/home.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/modal-panels.css') }}" rel="stylesheet">
<!-- Desktop Responsive CSS -->
<link href="{{ url_for('static', filename='css/responsive/desktop/navbar-desktop.css') }}" rel="stylesheet">
<!-- Mobile Responsive CSS -->
<link href="{{ url_for('static', filename='css/responsive/mobile/navbar-mobile.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/responsive/mobile/navbar-public-mobile.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/responsive/mobile/weather-info-mobile.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/responsive/mobile/weather-panels-mobile.css') }}" rel="stylesheet">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Debug: Check if CSS is loading -->
<script>
console.log('Home page CSS files should be loading...');
</script>
{% endblock %}

{% block content %}
<div class="weather-dashboard" style="margin: 0; padding: 0; min-height: 100vh; position: relative;">
    <!-- Video Background -->
    <video autoplay muted loop playsinline style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1;">
        <source src="{{ url_for('static', filename=background_video) }}" type="video/mp4">
        <source src="{{ url_for('static', filename='videos/bg_vdo02.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    
    <!-- Dynamic Background Component -->
    {% include 'components/weather-background.html' %}

    <!-- Top Bar Component -->
    {% include 'components/navbar-public.html' %}

    <!-- Main Weather Section -->
    <div class="main-weather-section">
        <!-- Weather Info Component -->
        {% include 'components/weather-info.html' %}
    </div>

    <!-- Right Side Panels Component -->
    {% include 'components/weather-panels.html' %}

    <!-- 7-Day Forecast Component -->
    {% include 'components/weather-forecast.html' %}
    
    <!-- Panels -->
    {% include 'components/search-panel.html' %}
    {% include 'components/map-panel.html' %}
    {% include 'components/notification-panel.html' %}
</div>

<!-- Component JavaScript Files -->
<script src="{{ url_for('static', filename='js/chart-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/ui-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/panels.js') }}"></script>

<script>
// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing components...');
    
    // Debug: Log background video path
    console.log('Background video path:', '{{ background_video }}');
    console.log('Background video URL:', '{{ url_for("static", filename=background_video) }}');
    
    // Check if functions exist
    if (typeof initWeatherCharts === 'function') {
        console.log('Initializing weather charts...');
        // Pass astronomy data to the chart initialization
        const astronomyData = {{ astronomy_data | tojson if astronomy_data else 'null' }};
        initWeatherCharts(astronomyData);
    } else {
        console.error('initWeatherCharts function not found!');
    }
    
    if (typeof initRiverHeightChart === 'function') {
        console.log('Initializing river height chart...');
        // Pass 7-day river data to the chart initialization
        const riverData = {{ river_7day | tojson if river_7day else 'null' }};
        initRiverHeightChart(riverData);
    } else {
        console.error('initRiverHeightChart function not found!');
    }
    
    if (typeof initUI === 'function') {
        console.log('Initializing UI components...');
        initUI();
    } else {
        console.error('initUI function not found!');
    }
});
</script>
{% endblock %}